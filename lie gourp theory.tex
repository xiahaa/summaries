\documentclass[a4paper]{report}
\usepackage{lipsum}
\usepackage{tikzpagenodes}
\usepackage{pgfplots}
\usepackage{tikz}
\usepackage{tikz-3dplot}
\usetikzlibrary{arrows,decorations.pathmorphing,backgrounds,positioning,fit,matrix}
\pgfplotsset{compat=1.8}
\usepackage{graphics} % for pdf, bitmapped graphics files
\usepackage{epsfig} % for postscript graphics files
\usepackage[colorlinks=true,citecolor=green]{hyperref}
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{url}
\usepackage{cite}
\usepackage{bm}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

\begin{document}

This section begins with the definition of the Special Orthogonal Group $\mathbb{SO}(3)$ and the Special Euclidean Group $\mathbb{SE}(3)$. The presentation is based on [][]. $\mathbb{SO}(3)$, defined with~\eqref{so3definition}, describes the group of $3D$ rotation matrices.
\begin{equation}
\mathbb{SO}(3):={\bm{R} \in \mathbb{R}^{3 \times 3}|RR^T=\bm{I_{3 \times 3}},\ det(\bold{R})=1}
\label{eq:SO3definition}
\end{equation}
$\mathbb{SE}(3)$ which represents rotation and translation is defined as follows:
\begin{equation}
\mathbb{SE}(3):=\left\lbrace
\bold{T}=\left[
\begin{matrix} 
\bold{R} & \bold{t} \\
\bold{0}^T & 1
\end{matrix}
\right] \in \mathbb{R}^{4 \times 4} \| {\bold{R}, \bold{t}} 
\in \mathbb{SO}(3) \times \mathbb{R}^3 \right\rbrace
\label{eq:SE3definition}
\end{equation}

A Lie group is a group which has the structure of a smooth manifold such that group composition and inversion are smooth operations. If G is a matrix Lie group, then $T \in G \subset \mathbb{R}^{n \times n}$ and its operations are matrix multiplication and inversion with the identity matrix as the identity element.

The Lie algebra $\mathfrak{g}$ associated to a $n$-dimensional matrix Lie group is an $n$-dimensional vector space which may be defined by a basis consisting of real matrices $\bold{E}_i$ for $i=1 \cdots n$. This basis defines a linear isomorphism between $\mathfrak{g}$ and $\mathbb{R}^n$ that we denote as 
$$
\begin{matrix}
\cdot^{\vee}: g \to \mathbb{R}^n \\ 
\hat{\cdot}: \mathbb{R}^n \to g
\end{matrix}
$$

Let $a \in g \subset \mathbb{R}^{n \times n}$, then we have $a^{\land}=k \in \mathbb{R}^n$. Thus, $\bold{E}_i^{\vee}=\bold{e}_i$ where $\bold{e}_i$ is the natural basis of $\mathbb{R}^n$ and $k=\sum_{i=1}^{n}{a_i \bold{E}_i}$. This will allow us to express the differential calculus of the filter computation in vector form with the minimal number of parameters $n$, as opposed to considering the matrices with $n^2$ coefficients. The link between a Lie group and its associated Lie algebra can be expressed with the exponential (exp) and logarithm (log) operations. The formula for exp, log are quite standard and they can be found for SO3 and SE3.


The matrix exponential $exp$ and matrix logarithm $log$ establish a local
diffeomorphism between an open neighbourhood of $0_{n \times n}$ in the
tangent space at the identity $T_eG$, called the Lie Algebra $g$, and an
open neighbourhood of $Id_{nxn}$ in $G$. The Lie Algebra $g$ associated to a
$p$ dimensional matrix Lie group is a $p$-dimensional vector space defined
by a basis consisting of real matrices.


The Lie algebra $\mathfrak{g}$ associated to a $n$-dimensional matrix Lie group is an $n$-dimensional tangent space which may be defined by a basis consisting of real matrices $\bold{E}_i$ for $i=1 \cdots n$. The link between a Lie group and its associated Lie algebra can be expressed with the exponential ($exp$) and logarithm ($log$) operations, which establish a local diffeomorphism between a neighborhood of $\bm{0}_{n \times n}$ at the identity in the tangent space to a local neighborhood of the identity on the manifold. $\mathfrak{g}$ associates to its vector space $\mathbb{R}^{n}$ by ${\cdot}^{\vee}: \mathfrak{g} \to \mathbb{R}^n$ and ${\cdot}^{\land}: \mathbb{R}^n \to \mathfrak{g}$.

This property allows to express the differential calculus, as needed for optimization, in vector space.


\begin{figure}
\centering
\tdplotsetmaincoords{60}{110}
\begin{tikzpicture}[tdplot_main_coords]
%draw the main coordinate system axes
%\draw[thick,->] (0,0,0) -- (1,0,0) node[anchor=south]{$x$};
%\draw[thick,->] (0,0,0) -- (0,1,0) node[anchor=north west]{$y$};
%\draw[thick,->] (0,0,0) -- (0,0,1) node[anchor=south]{$z$};

\tdplotsetthetaplanecoords{-60}
\draw[dashed,tdplot_rotated_coords] (2,0,0) arc (0:90:2);
\tdplotsetthetaplanecoords{-30}
\draw[dashed,tdplot_rotated_coords] (2,0,0) arc (0:90:2);
\tdplotsetthetaplanecoords{0}
\draw[dashed,tdplot_rotated_coords] (2,0,0) arc (0:90:2);
\tdplotsetthetaplanecoords{30}
\draw[dashed,tdplot_rotated_coords] (2,0,0) arc (0:90:2);
\tdplotsetthetaplanecoords{60}
\draw[dashed,tdplot_rotated_coords] (2,0,0) arc (0:90:2);
\tdplotsetthetaplanecoords{90}
\draw[dashed,tdplot_rotated_coords] (2,0,0) arc (0:90:2);
\shade[ball color = gray!40, opacity = 0.3] (2cm,0) arc (0:-180:2cm and 12mm) arc (180:0:2cm 
and 2cm);
\def\rad{2cm}
\newcommand*{\xMin}{-1}%
\newcommand*{\xMax}{15}%
\newcommand*{\yMin}{-10}%
\newcommand*{\yMax}{5}%

\begin{scope}[xslant=0.5,yshift=\rad,xshift=-2]
\filldraw[fill=red!10,opacity=0.6]
  (\xMin/5,\yMax/5,0) -- (\xMax/5,\yMax/5,0) -- (\xMax/5,\yMin/5,0) -- (\xMin/5,\yMin/5,0) -- cycle;
\foreach \i in {\xMin,...,\xMax} {
    \draw [very thin,gray] (\i/5,\yMin/5) -- (\i/5,\yMax/5);
    }
    \foreach \i in {\yMin,...,\yMax} {
        \draw [very thin,gray] (\xMin/5,\i/5) -- (\xMax/5,\i/5);
    }
\end{scope}
\draw (0, 0, 2) node [circle, fill=black, inner sep=.02cm] (0.02cm) {};
\coordinate (g0) at (0, -0.0, 2);
\draw (g0) node[above]  {$\bm{0}_{n \times n}$};
\coordinate (g1) at (1.5, -0.3, 2);
\draw (g1) node [circle, fill=black, inner sep=.02cm] (0.02cm) {};
\draw (g1) node[above]  {$\mathfrak{g}$};
\draw[->, thin] (g0) to[bend right=0] node[left,rotate=0] {} (g1);

\newcommand{\sphToCart}[3]
        {
          \def\rpar{#1}
          \def\thetapar{#2}
          \def\phipar{#3}

          \pgfmathsetmacro{\x}{\rpar*sin(\phipar)*cos(\thetapar)}
          \pgfmathsetmacro{\y}{\rpar*sin(\phipar)*sin(\thetapar)}
          \pgfmathsetmacro{\z}{\rpar*cos(\phipar)}
        }

\sphToCart{2}{0}{60}
\coordinate (X) at (\x, \y, \z);
\draw (X) node [circle, fill=black, inner sep=.02cm] (0.02cm) {};
\draw (X) node[left]  {$\mathbb{G}$};

\draw[<-, densely dotted] (X) to[bend right=40] node[right,rotate=0] {$exp$} (g1);
\draw[->, densely dotted] (X) to[bend left=40] node[left,rotate=0] {$log$} (g1);

\coordinate (p0) at (0,-1,3.5);
\coordinate (p1) at (0, 3,3.5);
\coordinate (po) at (0, 0,3.5);
\draw (p0) -- (p1);
\draw (po) node[above]  {$\bm{0}_{n \times 1}$};
\draw (po) node [circle, fill=black, inner sep=.02cm] (0.02cm) {};
\coordinate (pa) at (0, 1,3.5);
\draw (pa) node[above]  {$\bm{\xi}$};
\draw (pa) node [circle, fill=black, inner sep=.02cm] (0.02cm) {};
\draw[<-, densely dotted] (pa) to[bend right=40] node[left,rotate=0] {${\cdot}^{\vee}$} (g1);
\draw[->, densely dotted] (pa) to[bend left=40] node[right,rotate=0] {${\cdot}^{\land}$} (g1);
%\draw[<-, densely dotted] (pa) to[bend right=40] node[left,rotate=0] {${\mathfrak{g}}^{\vee}$} (g1);
%\draw[->, densely dotted] (pa) to[bend left=40] node[right,rotate=0] {${\bm{\xi}}^{\land}$} (g1);

  %\draw[dashed] (2,0,0) arc (0:360:2);
  %(0,0) circle (2cm);
  %\draw (0,0) circle (2cm,0) arc (0:-180:1);
  %\draw (0,2) arc (0:360:2 and 0.6);
  %\draw (-2,0) arc (180:360:2 and 0.6);
  %\draw[dashed] (2,0) arc (0:180:2 and 0.6);
  %\fill[fill=black] (0,0) circle (1pt);
  %\draw[dashed] (0,0 ) -- node[above]{$r$} (2,0);
\end{tikzpicture}
\caption{Mapping relationship among matrix Lie Group, Lie Algebra and the vector space.}
\label{fig:relationship}
\end{figure}

The logarithm map $log:\mathbb{SE}(3) \to \mathfrak{se}(3)$ is given by
TODO, the beneficial of using lie algebra.


The tangent space to the manifold (at the identity) is denoted $\mathfrak{so}(3)$, which is also called the Lie algebra and coincides with the space of $3 \times 3$ skew symmetric matrices. We can identify every skew symmetric matrix with a vector in $\mathbb{R}^3$ using the $\land$ operator:
\begin{equation}
\bm{\omega}=
\left[
\begin{matrix}
{\omega}_x \\ 
{\omega}_y \\ 
{\omega}_z
\end{matrix}
\right]^{\land}
=\left[
\begin{matrix}
0 & -\omega_z & \omega_y \\
\omega_z & 0 & -\omega_x \\ 
-\omega_y & \omega_x & 0 \\
\end{matrix}
\right]
\in \mathfrak{so}(3)
\end{equation}
Similarly, we can map a skew symmetric matrix to a vector in $\mathbb{R}^3$ using the $\vee$ operator: for a skew symmetric matrix $\mathbf{S}=\bm{\omega}^{\land}$, the $\vee$ operator is such that $\mathbf{S}^{\vee}=\bm{\omega}$. The exponential map (at the identity) exp: $\mathfrak{so}(3) \to \mathbf{SO}(3)$ associate an element of the Lie Algebra to a rotation matrix:
\begin{equation}
exp(\bm{\phi}^{\land})=
\bm{I}+\frac{sin(\parallel \bm{\phi} \parallel)}{\parallel \bm{\phi} \parallel}\bm{\phi}^{\land}+\frac{1-cos(\parallel \bm{\phi} \parallel)}{{\parallel \bm{\phi} \parallel}^2
}(\bm{\phi^{\land}})^{2} 
\end{equation}
A first-order approximation of the exponential map is:
\begin{equation}
exp(\bm{\phi}^{\land})=\bm{I}+\bm{{\phi}^{\land}}.
\end{equation}
The logarithm map (at the identity) associate a matrix $R \in \mathbb{SO}(3)$ to a skew symmetric matrix:
\begin{equation}
log(R)=\frac{\theta \cdot (R-R^T)}{2sin(\theta)}\ with\ \theta=cos^{-1}(\frac{trace(R)-1}{2}).
\end{equation}
Note that $log(R)^\vee = \bm{a}\theta$, where $\bm{a}$ and $\theta$ are the rotation axis and rotation angle of $R$, respectively.

The exponential map is a bijection if restricted to the open ball $\parallel\phi\parallel < \pi$, and the corresponding inverse is the logarithm map. However, if we do not restrict the domain, the exponential map becomes surjective as every vector $\phi = (\varphi+2k\pi)\bm{a},\ k \in \mathbb{Z}$ would be an admissible logarithm map.
For notation convenience, we adopt "vectorized" versions of the exponential and logarithm map:
\begin{equation}
\left.
\begin{matrix}
Exp: \mathbb{R}^3 \ni \bm{\phi} \to exp(\bm{\phi}^{\land}) \in \mathbb{SO}^3, \\
Log: \mathbb{SO}^3 \ni R \to log(R)^{\vee} \in \mathbb{R}^3
\end{matrix}
\right.
\end{equation}
which operate directly on vectors, rather than on $\mathfrak{so}(3)$.


Later, we will use the following first-order approximation:
\begin{equation}
Exp(\bm{\phi}+\delta \bm{\phi})\approx Exp(\bm{\phi})Exp(J_r(\bm{\phi}) \delta \bm{\phi}).
\end{equation}
The term $J_r(\bm{\phi}$ is the right Jacobian of $\mathbb{SO}(3)$ and relates additive increments in the tangent space to multiplication increments applied on the right-hand-side:
\begin{equation}
J_r({\bm{\phi}})=\bm{I}-\frac{1-cos(\parallel \phi \parallel)}{{\parallel \phi \parallel}^2}\bm{\phi^{\land}}+\frac{\parallel \phi \parallel - sin(\parallel \bm{\phi} \parallel)}{\bm{\phi^{3}}}(\bm{\phi}^{\land})^2
\end{equation}
A similar first-order approximation holds for the logarithm:
\begin{equation}
Log(Exp(\bm{\phi}))\approx \bm{\phi}+J_r^{-1}(\bm{\phi})\delta \bm{\phi}
\end{equation}
An explicit expression for the inverse of the right Jacobian is given in the supplementary material[29]. $J_r{\bm{\phi}}$ reduces to the identity for $\parallel \bm{\phi} \parallel=0$.

Another useful property of the exponential map that follows directly from the Adjoint representation is:
\begin{eqnarray}
R Exp(\bm{\phi}) R^T = exp(R\bm{\phi}^{\land}R^T)=Exp(R\bm{\phi}) \\ 
\iff Exp(\bm{\phi})R=RExp(R^T\bm{\phi})
\end{eqnarray}
Special Euclidean Group: $\mathbb{SE}(3)$ describes the group of rigid motion in 3D and it is defined as . The group operation is 
$$
T_1 \cdot T_2=
\left[
\begin{matrix}
R_1R_2 & \bm{p_2}+R1\cdot \bm{p_1} \\
0^T & 0
\end{matrix}
\right]
$$
and the inverse is 
$$
T_1^{-1}=\left[
\begin{matrix}
R_1^-1 & -R_1^{-1}\bm{p_1} \\
0^T & 0
\end{matrix}
\right]
$$
The exponential and logarithm map are define in [32]. 




Gauss-Newton Method on Manifold
Let us consider the optimization problem $min_{x \in \mathcal{M}}{f(x)}$, where $f(x)$ is a given cost function, and the variable $x$ belongs to a manifold $\mathcal{M}$; for simplicity we consider a single variable, while the description can be easily generalized.

A standard approach for optimization on manifold consists of defineing a retraction $R$, which is a bijective map between an element $\delta x$ of the tangent space (at $x$) and a neighborhood of $x \in \mathcal{M}$. Using the retraction, we can re-parametrize our problem as follows:
\begin{equation}
{\operatorname*{min}_{x \in \mathcal{M}} {f(x)}} \rightarrow {\operatorname*{min}_{\delta x \in \mathbb{R}^n} {f(R_x(\delta x))}}
\end{equation}
The re-parametrization is usually called lifting. Roughly speaking, we work in the tangent space defined at the current estimate, which locally behaves as an Euclidean space. We can now apply standard optimization techniques to the problem on the right in (14). In the general GN framework, we square the cost around the current estimate. Then we solve the quadratic approximation to get a vector $\delta x^*$ in the tangent space. Finally, the current guess on the manifold is updated as $\hat{x} \leftarrow R_{\hat{x}}(\delta x^*)$. 

A possible retraction is the exponential map. However, computationally, this may be not the most convenient, see [].
For SE3, we use the following retraction at $T=(R,\bm{p})$:
$R_T(\delta \bm{\phi}, \delta \bm{p})=(R Exp(\delta \bm{\phi})), \bm{p}+R\delta \bm{p}, [\delta \bm{\phi}, \delta \bm{p}]\in \mathbb{R}^6$.

The Baker-Campbell-Haussdorff formula which expresses the group product directly in $\mathbb{R}^p$:
$$
[log_G{(exp_G)([a]^\land)exp_G([b]^\land))}]_G^\vee = a + b + O(|a,b|^2)
$$

\section{Filter on Lie Group}
TODO add complementary filter theory on $\mathbb{SO}(3)$ and the EUROSIP journal of EKF on Lie group.

\end{document}